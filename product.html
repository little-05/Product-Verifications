<!DOCTYPE html>
<html lang="en">

<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>QR Product Verification</title>
<script src="https://unpkg.com/html5-qrcode"></script>

<!-- Google Material Icons -->
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

<style>
  body {
    font-family: "Roboto", Arial, sans-serif;
    background: #f2f4f8;
    padding: 20px;
    margin: 0;
  }

  h2 {
    text-align: center;
    font-weight: 600;
    color: #2c3e50;
  }

  .container {
    max-width: 480px;
    margin: auto;
  }

  input {
    width: 100%;
    padding: 14px;
    margin-top: 12px;
    border-radius: 10px;
    border: 1px solid #ccc;
    font-size: 16px;
    outline: none;
  }

  button {
    width: 100%;
    padding: 14px;
    margin-top: 12px;
    border: none;
    background: #1976d2;
    color: white;
    font-size: 16px;
    border-radius: 10px;
    cursor: pointer;
  }

  button:active {
    opacity: 0.8;
  }

  .card {
    background: white;
    padding: 20px;
    margin-top: 25px;
    border-radius: 16px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.12);
  }

  .info-row {
    margin: 6px 0;
    font-size: 16px;
  }

  .status-badge {
    padding: 6px 10px;
    border-radius: 8px;
    color: white;
    font-weight: bold;
    display: inline-block;
    margin-left: 8px;
  }

  .valid {
    background: #2ecc71;
  }

  .invalid {
    background: #e74c3c;
  }

  #reader {
    margin-top: 20px;
    border-radius: 10px;
    overflow: hidden;
  }

  .scan-again {
    background: #27ae60 !important;
  }

</style>
</head>

<body>

<div class="container">
  <h2>Product Verification</h2>

  <input type="text" id="manualInput" placeholder="Enter Product ID">
  <button onclick="manualSearch()">
    <span class="material-icons" style="vertical-align: middle;">search</span> Search
  </button>

  <div id="reader" style="width:100%;"></div>

  <button id="scanAgainBtn" class="scan-again" style="display:none;" onclick="restartScanner()">
    <span class="material-icons" style="vertical-align: middle;">qr_code_scanner</span> Scan Again
  </button>

  <div id="result"></div>
</div>

<script>
let productList = [];
let scanner;

// Load JSON from external file
fetch("products.json")
  .then(res => res.json())
  .then(data => {
    productList = data;
    console.log("JSON Loaded:", productList);
  })
  .catch(err => console.error("JSON load error:", err));


// Show product card
function showProduct(product) {
  let statusColor = product.Status.toLowerCase() === "valid" ? "valid" : "invalid";

  document.getElementById("result").innerHTML = `
    <div class="card">
      <div class="info-row"><b>Product ID:</b> ${product.ProductID}</div>
      <div class="info-row"><b>Name:</b> ${product.ProductName}</div>
      <div class="info-row"><b>Batch:</b> ${product.Batch}</div>
      <div class="info-row"><b>MFG Date:</b> ${product.MFGDate}</div>
      <div class="info-row"><b>EXP Date:</b> ${product.EXPDate}</div>
      <div class="info-row">
        <b>Status:</b>
        <span class="status-badge ${statusColor}">${product.Status}</span>
      </div>
    </div>
  `;

  document.getElementById("scanAgainBtn").style.display = "block";
}


// Manual Search
function manualSearch() {
  let pid = document.getElementById("manualInput").value.trim();

  let match = productList.find(p => p.ProductID === pid);

  if (match) {
    showProduct(match);
  } else {
    document.getElementById("result").innerHTML =
      `<p style="color:red; margin-top:20px;">❌ No product found</p>`;
  }
}


// QR Success
function onScanSuccess(decodedText) {
  let match = productList.find(p => p.ProductID === decodedText);

  if (match) {
    showProduct(match);
  } else {
    document.getElementById("result").innerHTML =
      `<p style="color:red; margin-top:20px;">❌ Invalid Product</p>`;
  }

  scanner.clear();
  document.getElementById("scanAgainBtn").style.display = "block";
}


// Start QR Scanner
scanner = new Html5QrcodeScanner("reader", {
  fps: 10,
  qrbox: 250
});
scanner.render(onScanSuccess);


// Restart scanner
function restartScanner() {
  document.getElementById("result").innerHTML = "";
  document.getElementById("scanAgainBtn").style.display = "none";
  scanner.render(onScanSuccess);
}
</script>

</body>
</html>
