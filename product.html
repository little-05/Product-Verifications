<!DOCTYPE html>
<html>
<head>
  <title>Product Verification</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background: #f2f2f2;
    }
    .card {
      background: #fff;
      padding: 20px;
      border-radius: 10px;
      border: 1px solid #ccc;
      max-width: 450px;
    }
    .error {
      color: red;
      font-size: 18px;
      font-weight: bold;
    }
  </style>
</head>
<body>

<h2>Product Verification</h2>
<div id="result">Loading...</div>

<script>
  const urlParams = new URLSearchParams(window.location.search);
  const productID = urlParams.get("id");

  if (!productID) {
    document.getElementById("result").innerHTML =
      '<p class="error">❌ Product ID missing. Use: product.html?id=PRD001</p>';
  }

  // --------------------------
  // MAIN GOOGLE SHEET CSV LINK
  // --------------------------
  const CSV_LINK = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQ8Wv2XV--hyJK1ny3D5NiII-3vtotKAnbgmQ9ZoDxQto8r-PCWLM49hGM4dOip8tOupf_ue57GszdB/pub?gid=0&single=true&output=csv"; 
  // Example: https://docs.google.com/spreadsheets/d/XXXXX/export?format=csv

  // --------------------------
  // JSON FALLBACK
  // --------------------------
  const JSON_FALLBACK = "products.json";

  async function loadFromSheet() {
    const res = await fetch(CSV_LINK);
    if (!res.ok) throw new Error("Sheet error");

    const csv = await res.text();
    const lines = csv.trim().split("\n");

    const headers = lines[0].split(",");
    const data = [];

    for (let i = 1; i < lines.length; i++) {
      let row = lines[i].split(",");
      let obj = {};
      headers.forEach((h, idx) => {
        obj[h.trim()] = row[idx] ? row[idx].trim() : "";
      });
      data.push(obj);
    }

    return data;
  }

  async function loadFromJSON() {
    const res = await fetch(JSON_FALLBACK);
    if (!res.ok) throw new Error("JSON not found");
    return res.json();
  }

  async function loadData() {
    try {
      console.log("Trying Google Sheet…");
      return await loadFromSheet();
    } catch (err) {
      console.log("Sheet failed. Switching to JSON fallback…");
      try {
        return await loadFromJSON();
      } catch (err2) {
        document.getElementById("result").innerHTML =
          '<p class="error">❌ Cannot load product data.</p>';
        return [];
      }
    }
  }

  // MAIN EXECUTION
  loadData().then(data => {
    const product = data.find(p =>
      p.ProductID === productID || p.id === productID
    );

    if (!product) {
      document.getElementById("result").innerHTML =
        '<p class="error">❌ Invalid Product — Not Found</p>';
      return;
    }

    // Compatible with sheet + JSON
    const pid = product.ProductID || product.id;
    const name = product.ProductName || product.name;
    const desc = product.Description || product.description;
    const status = product.Status || (product.valid ? "Valid" : "Invalid");

    document.getElementById("result").innerHTML = `
      <div class="card">
        <p><b>Product ID:</b> ${pid}</p>
        <p><b>Name:</b> ${name}</p>
        <p><b>Description:</b> ${desc}</p>
        <p><b>Status:</b> ${status}</p>
      </div>
    `;
  });
</script>

</body>
</html>
